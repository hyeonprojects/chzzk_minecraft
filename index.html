<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹˜ì§€ì§ ì¸ì¦ ì½”ë“œ ìš”ì²­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-hint {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .response-section {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .response-section.show {
            display: block;
        }

        .response-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .response-item {
            margin-bottom: 12px;
        }

        .response-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
            display: block;
            margin-bottom: 5px;
        }

        .response-value {
            background: white;
            padding: 10px;
            border-radius: 6px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            color: #856404;
        }

        .warning strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
<div class="container" id="authFormContainer">
    <h1>ğŸ® ì¹˜ì§€ì§ ì¸ì¦ ì½”ë“œ ìš”ì²­</h1>
    <p class="subtitle">Access Token ë°œê¸‰ì„ ìœ„í•œ ì¸ì¦ ì½”ë“œë¥¼ ìš”ì²­í•©ë‹ˆë‹¤</p>

    <form id="authForm">
        <div class="form-group">
            <label for="clientId">
                Client ID <span class="required">*</span>
            </label>
            <input
                    type="text"
                    id="clientId"
                    name="clientId"
                    placeholder="fefb6bbb-00c2-497c-afc2-XXXXXXXXXXXX"
                    required
            >
            <div class="input-hint">ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ ì‹œ ë°œê¸‰ë°›ì€ Client IDë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
        </div>

        <div class="form-group">
            <label for="redirectUri">
                Redirect URI <span class="required">*</span>
            </label>
            <input
                    type="text"
                    id="redirectUri"
                    name="redirectUri"
                    placeholder="http://localhost:8080/api/path"
                    value="http://localhost:8080/api/callback"
                    required
            >
            <div class="input-hint">ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ ì‹œ ì…ë ¥í•œ ë¡œê·¸ì¸ ë¦¬ë””ë ‰ì…˜ URLê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤</div>
        </div>

        <div class="form-group">
            <label for="state">
                State <span class="required">*</span>
            </label>
            <input
                    type="text"
                    id="state"
                    name="state"
                    placeholder="zxclDasdfA25"
                    required
            >
            <div class="input-hint">CSRF ê³µê²© ë°©ì§€ë¥¼ ìœ„í•œ ì„ì˜ì˜ ë¬¸ìì—´ (ìë™ ìƒì„±ë¨)</div>
        </div>

        <div class="button-group">
            <button type="button" class="btn-secondary" onclick="generateState()">State ìƒì„±</button>
            <button type="submit" class="btn-primary">ì¸ì¦ ìš”ì²­</button>
        </div>
    </form>

    <div class="warning">
        <strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong>
        Redirect URIëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ ì‹œ ì…ë ¥í•œ ë¡œê·¸ì¸ ë¦¬ë””ë ‰ì…˜ URLê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
    </div>
</div>

<!-- ì¸ì¦ ì‘ë‹µ í˜ì´ì§€ -->
<div class="container" id="responseContainer" style="display: none;">
    <h1>âœ… ì¸ì¦ ì„±ê³µ!</h1>
    <p class="subtitle">ì¹˜ì§€ì§ ì¸ì¦ ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤</p>

    <div class="response-section show">
        <div class="response-title">ğŸ“‹ ì¸ì¦ ì‘ë‹µ ì •ë³´</div>

        <div class="response-item">
            <span class="response-label">Authorization Code</span>
            <div class="response-value" id="authCode">-</div>
        </div>

        <div class="response-item">
            <span class="response-label">State</span>
            <div class="response-value" id="responseState">-</div>
        </div>

        <div class="response-item">
            <span class="response-label">State ê²€ì¦</span>
            <div class="response-value" id="stateValidation">-</div>
        </div>

        <div class="response-item">
            <span class="response-label">ìˆ˜ì‹  ì‹œê°</span>
            <div class="response-value" id="timestamp">-</div>
        </div>

        <div class="response-item">
            <span class="response-label">Response Object (JSON)</span>
            <div class="response-value" id="responseJson" style="white-space: pre-wrap;">-</div>
        </div>
    </div>

    <div class="warning" style="background: #d4edda; border-left-color: #28a745; color: #155724;">
        <strong>âœ“ ë‹¤ìŒ ë‹¨ê³„</strong>
        ì´ì œ ì´ Authorization Codeë¥¼ ì‚¬ìš©í•˜ì—¬ Access Tokenì„ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>

    <div class="button-group">
        <button type="button" class="btn-secondary" onclick="copyToClipboard()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
        <button type="button" class="btn-primary" onclick="resetPage()">ğŸ”„ ìƒˆë¡œ ìš”ì²­</button>
    </div>
</div>

<script>
    // State ìë™ ìƒì„± í•¨ìˆ˜ (8ìë¦¬)
    function generateState() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let state = '';
        for (let i = 0; i < 8; i++) {
            state += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        document.getElementById('state').value = state;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ State ìë™ ìƒì„±
    window.addEventListener('DOMContentLoaded', () => {
        // URLì—ì„œ codeì™€ state íŒŒë¼ë¯¸í„° í™•ì¸ (ë¦¬ë””ë ‰ì…˜ í›„)
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const state = urlParams.get('state');

        if (code && state) {
            // ì‘ë‹µ í˜ì´ì§€ í‘œì‹œ
            showResponsePage(code, state);
        } else {
            // ì¸ì¦ ìš”ì²­ í˜ì´ì§€ í‘œì‹œ
            generateState();
        }
    });

    // ì‘ë‹µ í˜ì´ì§€ í‘œì‹œ í•¨ìˆ˜
    function showResponsePage(code, state) {
        // ì €ì¥ëœ stateì™€ ë¹„êµ ê²€ì¦
        const savedState = localStorage.getItem('chzzk_oauth_state');
        const stateValid = savedState === state;

        // í˜„ì¬ ì‹œê°
        const now = new Date();
        const timestamp = now.toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        });

        // ì‘ë‹µ ë°ì´í„° ê°ì²´ ìƒì„±
        const responseData = {
            code: code,
            state: state,
            stateValid: stateValid,
            savedState: savedState,
            timestamp: timestamp
        };

        // ì½˜ì†”ì— ì¶œë ¥
        console.log('=== ì¹˜ì§€ì§ ì¸ì¦ ì‘ë‹µ ===');
        console.log('ë°›ì€ Code:', code);
        console.log('ë°›ì€ State:', state);
        console.log('ì €ì¥ëœ State:', savedState);
        console.log('State ì¼ì¹˜ ì—¬ë¶€:', stateValid);
        console.log('Timestamp:', timestamp);
        console.log('Response Object:', responseData);

        // State ê²€ì¦ ì‹¤íŒ¨ ê²½ê³ 
        if (!stateValid) {
            console.warn('âš ï¸ State ê°’ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤! CSRF ê³µê²© ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.');
            console.warn('ìš”ì²­ ì‹œ State:', savedState);
            console.warn('ì‘ë‹µ ë°›ì€ State:', state);
        }

        // í¼ ìˆ¨ê¸°ê³  ì‘ë‹µ í˜ì´ì§€ í‘œì‹œ
        document.getElementById('authFormContainer').style.display = 'none';
        document.getElementById('responseContainer').style.display = 'block';

        // í™”ë©´ì— ë°ì´í„° í‘œì‹œ
        document.getElementById('authCode').textContent = code;
        document.getElementById('responseState').textContent = state + (savedState ? ` (ìš”ì²­: ${savedState})` : '');
        document.getElementById('stateValidation').textContent = stateValid ? 'âœ“ ê²€ì¦ ì„±ê³µ (State ì¼ì¹˜)' : 'âœ— ê²€ì¦ ì‹¤íŒ¨ (State ë¶ˆì¼ì¹˜)';
        document.getElementById('stateValidation').style.color = stateValid ? '#28a745' : '#dc3545';
        document.getElementById('stateValidation').style.fontWeight = stateValid ? 'normal' : 'bold';
        document.getElementById('timestamp').textContent = timestamp;

        // Response Objectë¥¼ JSONìœ¼ë¡œ í‘œì‹œ
        document.getElementById('responseJson').textContent = JSON.stringify(responseData, null, 2);

        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (í•„ìš”ì‹œ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©)
        sessionStorage.setItem('chzzk_auth_code', code);
        sessionStorage.setItem('chzzk_auth_state', state);
        sessionStorage.setItem('chzzk_state_valid', stateValid);

        // localStorage ì •ë¦¬
        localStorage.removeItem('chzzk_oauth_state');
    }

    // í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬
    function copyToClipboard() {
        const code = document.getElementById('authCode').textContent;
        navigator.clipboard.writeText(code).then(() => {
            alert('âœ… Authorization Codeê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }).catch(() => {
            // í´ë°±: í…ìŠ¤íŠ¸ ì˜ì—­ ì‚¬ìš©
            const textarea = document.createElement('textarea');
            textarea.value = code;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('âœ… Authorization Codeê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
    }

    // í˜ì´ì§€ ì´ˆê¸°í™”
    function resetPage() {
        // URL íŒŒë¼ë¯¸í„° ì œê±°í•˜ê³  í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        window.location.href = window.location.pathname;
    }

    // í¼ ì œì¶œ ì²˜ë¦¬
    document.getElementById('authForm').addEventListener('submit', (e) => {
        e.preventDefault();

        const clientId = document.getElementById('clientId').value.trim();
        const redirectUri = document.getElementById('redirectUri').value.trim();
        const state = document.getElementById('state').value.trim();

        if (!clientId || !redirectUri || !state) {
            alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        // ì¹˜ì§€ì§ ì¸ì¦ URL ìƒì„±
        const authUrl = new URL('https://chzzk.naver.com/account-interlock');
        authUrl.searchParams.append('clientId', clientId);
        authUrl.searchParams.append('redirectUri', redirectUri);
        authUrl.searchParams.append('state', state);

        // State ê°’ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ê²€ì¦ìš©)
        localStorage.setItem('chzzk_oauth_state', state);

        // ì¹˜ì§€ì§ ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
        window.location.href = authUrl.toString();
    });
</script>
</body>
</html>
